# 连线基本功能

1. 因为连线比较细，所以需要当鼠标靠近连线的时候，就触发连线的hover和相关调整功能。
2. 连线可以支持自由添加调整点模式。
3. 连线可以支持平移拖动调整。
4. 连线目前都是直线的。不排除之后可能是曲线、大箭头等。
5. 连线曲线的调整模式和直线是不一样的。所以需要将线的调整方式给单独提出来。
6. 需要控制鼠标的状态`cursor: pointer`。
7. 连线对齐基准线。
8. 拖动连线到目标元素上的，连接目标元素。
9. 当鼠标靠近某个元素的时候，元素高亮或者虚线包裹它

## 连线相关的元素

1. 单点调整工具
2. 平移调整工具
3. 弧线调整工具
4. 箭头

## 技术方案

### graph监听鼠标位置，做出计算

graph监听`mousemove`，实时计算与所有连线和图形位置关系。可以获取到鼠标靠近连线，元素。也可以实现拖动连线的时候获取目的元素是否瞒住需求。

缺点: 每次移动触发计算太多

如果采用包裹元素监听`mousemove`事件, 会显得混乱。

> 统一监听然后去计算位置相比每个元素单独监听性能差吗？

这里我们分别以10， 100，1000, 10000个节点来模拟一下。

更好的算法？

1. 将所有的节点按照其所处的位置进行分区？桶排序思路。这样能依据当前鼠标所处位置，直接从对应的区查找。
2. 直接从可视区域去查找，看不到的组件，就不看了。

> 直接从可视区域查找这个思路，可以解决数量达到10000的时候，因为DOM太多而导致的卡顿问题。不显示的就不创建到DOM中。

采用第二种方案，需要修改的地方有。

画布移动和放大缩小后，需要重新计算所有的节点是否显示。（如果量比较大，这里会比较卡。也就是当用户通过缩小来看全景的时候，需要延迟）

将节点显示和隐藏做成异步。

综合上面的方案，使用全局监听`mousemove`是可行的。
